const VDF = require('./VDF');

class App extends VDF
{
    constructor (app_id)
    {
        super();

        this._app_id       = app_id;
        this._description  = '';
        this._build_output = '../build/';
        this._content_root = '../content/';
        this._branch       = '';
        this._preview      = false;
        this._local_server = '';
        this._depots       = [];
    }

    set description (value)
    {
        this._description = value;
    }

    set build_output (value)
    {
        this._build_output = value;
    }

    set content_root (value)
    {
        this._content_root = value;
    }

    set branch (value)
    {
        this._branch = value;
    }

    set preview (value)
    {
        this._preview = value !== '0';
    }

    set local_server (value)
    {
        this._local_server = value;
    }

    get app_id ()
    {
        return this._app_id;
    }

    get description ()
    {
        return this._description;
    }

    get build_output ()
    {
        return this._build_output;
    }

    get content_root ()
    {
        return this._content_root;
    }

    get branch ()
    {
        return this._branch;
    }

    get preview ()
    {
        return this._preview === 'true' ? '1' : '0';
    }

    get local_server ()
    {
        return this._local_server;
    }

    get depots ()
    {
        const output = {};

        this._depots.forEach(depot => {
            output[depot.depot_id] = `depot_build_${depot.depot_id}.vdf`;
        });

        return output;
    }

    addDepot (depot)
    {
        this._depots.push(depot);
    }

    removeDepot(depot_id)
    {
        this._depots = this._depots.filter(obj => {
            return obj._depot_id !== `${depot_id}`;
        });
    }

    getDepot (depot_id)
    {
        if (typeof this._depots[depot_id] === 'undefined') {
            throw new Error(`Depot ${depot_id} not found in app ${this.app_id}`);
        }

        return this._depots[depot_id];
    }

    getDepots ()
    {
        return this._depots;
    }

}

module.exports = App;